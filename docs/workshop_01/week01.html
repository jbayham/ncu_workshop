<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jude Bayham">

<title>Workshop 01: Introduction to Geospatial Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="week01_files/libs/clipboard/clipboard.min.js"></script>
<script src="week01_files/libs/quarto-html/quarto.js"></script>
<script src="week01_files/libs/quarto-html/popper.min.js"></script>
<script src="week01_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="week01_files/libs/quarto-html/anchor.min.js"></script>
<link href="week01_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="week01_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="week01_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="week01_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="week01_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a>
  <ul class="collapse">
  <li><a href="#reading" id="toc-reading" class="nav-link" data-scroll-target="#reading">Reading</a></li>
  <li><a href="#statistics-japan" id="toc-statistics-japan" class="nav-link" data-scroll-target="#statistics-japan">Statistics Japan</a></li>
  <li><a href="#rstudio" id="toc-rstudio" class="nav-link" data-scroll-target="#rstudio">RStudio</a></li>
  </ul></li>
  <li><a href="#geospatial-data-overview" id="toc-geospatial-data-overview" class="nav-link" data-scroll-target="#geospatial-data-overview">Geospatial Data Overview</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting started</a>
  <ul class="collapse">
  <li><a href="#reading-spatial-data" id="toc-reading-spatial-data" class="nav-link" data-scroll-target="#reading-spatial-data">Reading spatial data</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Workshop 01: Introduction to Geospatial Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jude Bayham </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<!-- flashy geospatial image -->
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The objective of this workshop is to introduce you to geospatial data. You will acquire, assemble, process, and map spatial data.</p>
</section>
<section id="prerequisites" class="level2">
<h2 class="anchored" data-anchor-id="prerequisites">Prerequisites</h2>
<section id="reading" class="level3">
<h3 class="anchored" data-anchor-id="reading">Reading</h3>
<p>There are many sources and references available online to help you learn to work with spatial data in R. Taro Mieno is an economist at University of Nebraska-Lincoln and he has written an online book, <a href="https://tmieno2.github.io/R-as-GIS-for-Economists-Quarto/">R as GIS for Economists</a>, to help economists learn to use R for GIS: . Please read <a href="https://tmieno2.github.io/R-as-GIS-for-Economists-Quarto/chapters/02-VectorDataBasics.html">Chapter 2 Vector Data Handling with sf</a> in preparation for the workshop. The reading covers some of the basics of vector type spatial data that we will learn. Being familiar with these concepts will allow you to understand the workshop better and ask more in-depth questions during the workshop.</p>
<p>You may also find <a href="https://r.geocompx.org/">Geocomputation with R</a> by Lovelace et al.&nbsp;a helpful resource. It is written for a broader audience, but provides more detail than <em>R as GIS for Economists</em>.</p>
</section>
<section id="statistics-japan" class="level3">
<h3 class="anchored" data-anchor-id="statistics-japan">Statistics Japan</h3>
<p>We will access data from <a href="https://www.e-stat.go.jp/" class="uri">https://www.e-stat.go.jp/</a> using their application programming interface (API). You will need to register for an API key in order to use the API. These were the instructions and link names in English. I will update these with instructions in Japanese.</p>
<ol type="1">
<li><p>Follow the links to create an account.</p></li>
<li><p>Click the link to “My Page”.</p></li>
<li><p>Click the link to “API function (application ID issuance)”</p></li>
<li><p>Complete the fields name (a name for your application: Rscript) and URL (http://test.localhost/)</p></li>
<li><p>Click “issue” to the right</p></li>
<li><p>The appID field should now contain a long string of numbers and letters. This is the key associated with your account. You will use this to query data through the API.</p></li>
<li><p>Set appID as an environmental variable by typing the following code in R: <code>usethis::edit_r_environ()</code>. This command uses the function <code>edit_r_environ()</code> from the package called <code>usethis</code>. If you have not installed the package, first type <code>install.packages("usethis")</code> to install the package. Then, add a line <code>STATISTICS_JAPAN_API_KEY = "your_key_here"</code>. And save the file. Restart the R kernel.</p></li>
</ol>
</section>
<section id="rstudio" class="level3">
<h3 class="anchored" data-anchor-id="rstudio">RStudio</h3>
<p>We will be working with packages designed to process and visualize geospatial data. You can install a package by typing the following into the console: <code>install.packages("package_name")</code>. <em>Note the quotations</em>. Please install the following packages on the computer you will be using:</p>
<ul>
<li><code>sf</code>: simple features a package with many utilities for working with spatial vector data</li>
<li><code>raster</code>: a package for working with raster data</li>
<li><code>mapview</code>: a package for creating interactive maps of vector and raster data</li>
<li><code>ggplot</code>: a package for plotting data (included in tidyverse)</li>
</ul>
<p><em>Note that you do not need to install packages if they are already installed - you only need to install packages once.</em></p>
</section>
</section>
<section id="geospatial-data-overview" class="level2">
<h2 class="anchored" data-anchor-id="geospatial-data-overview">Geospatial Data Overview</h2>
<ul>
<li><p><strong>Definition</strong>: Geospatial data is data that includes location information, meaning it includes data linked to locations on the Earth’s surface. Geospatial data is usually represented as coordinates (latitude, longitude) or as addresses, regions, or other geographic identifiers.</p></li>
<li><p><strong>Types of Geospatial Data</strong>:</p>
<ul>
<li><strong>Vector data</strong>: Represents geographic features using points, lines, and polygons (e.g., locations of stores, roads, or regions).</li>
<li><strong>Raster data</strong>: Represents data in a grid format, typically used for continuous variables (e.g., elevation, temperature, satellite imagery).</li>
</ul></li>
<li><p><strong>Coordinate Reference Systems (CRS)</strong>: Defines how spatial data is mapped onto the Earth’s surface. It’s crucial to understand CRS when working with multiple datasets to ensure they align correctly (e.g., WGS 84, UTM).</p></li>
<li><p><strong>Projections</strong>: Geospatial data must be projected to represent the 3D Earth on a 2D surface. Different projections minimize different types of distortions (e.g., area, shape, distance).</p></li>
<li><p><strong>Geospatial Packages in R</strong>:</p>
<ul>
<li><strong>sf</strong>: Simple Features for R, a package for working with vector data.</li>
<li><strong>raster</strong>: A package for working with raster data.</li>
<li><strong>sp</strong>: An older package that also handles spatial data but is being gradually replaced by <code>sf</code>.</li>
</ul></li>
<li><p><strong>Common Tasks</strong>:</p>
<ul>
<li>Loading and visualizing geospatial data.</li>
<li>Transforming data to different CRS.</li>
<li>Performing spatial operations like intersections, unions, and buffers.</li>
<li>Creating maps and conducting spatial analysis (e.g., proximity analysis, clustering).</li>
</ul></li>
<li><p><strong>File Formats</strong>:</p>
<ul>
<li><strong>Shapefiles</strong>: A common vector data format that consists of multiple files.</li>
<li><strong>GeoTIFF</strong>: A common raster data format.</li>
<li><strong>GeoJSON</strong>: A lightweight format for sharing geospatial data online.</li>
</ul></li>
</ul>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
<p>Let’s get some data and read it into R. The Geospatial Information Authority of Japan seems provides downloadable maps of the country: <a href="https://www.gsi.go.jp/kankyochiri/gm_japan_e.html" class="uri">https://www.gsi.go.jp/kankyochiri/gm_japan_e.html</a>. Download the Global Map Japan version 2.2 Vector data (Released in 2016) by clicking on the linked file: <code>gm-jpn-all_u_2_2.zip</code> (9.2MB). This is a zipped file containing many files. <strong>Note where you download the file</strong>.</p>
<p>Before opening Rstudio and working with the data, you should organize your digital workspace.</p>
<ol type="1">
<li><p>Create a directory for this workshop titled: <code>workshop_01</code>. If you already have a directory for this class/seminar, create the directory under the class directory.</p></li>
<li><p>Create a directory titled <code>inputs</code> under <code>workshop_01</code>. The path should be <code>workshop_01/inputs</code>.</p></li>
<li><p>Copy or move the directory created by unzipping <code>gm-jpn-all_u_2_2.zip</code> into <code>workshop_01/inputs</code>.</p></li>
</ol>
<p>Open up Rstudio and do the following:</p>
<ol type="1">
<li><p>Open a new script.</p></li>
<li><p>Write a comment with a brief description about what the script does. In most cases, you know the intention of the script. Since this is a workshop, type <code>#This is an introduction to working with spatial data in R</code></p></li>
<li><p>Load the package <code>pacman</code> and use <code>p_load()</code> to install and load the packages we will be using in this workshop.</p></li>
<li><p>Navigate to <code>workshop_01</code> (the directory you just created for the project). You can use the dropdown menu Session &gt; Set Working Directory &gt; Choose Directory or type the <code>setwd("path_here")</code> command at the top of your script. If you use the dropdown menu, R will generate the <code>setwd()</code> command and display it in the console. Copy and paste it into your script.</p></li>
<li><p>Save your script and title the file: <code>workshop_01.R</code></p></li>
</ol>
<p>The first several lines of your script should look something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is an introduction to working with spatial data in R</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman) <span class="co">#if you have never used this package, you need to install it: install.packages("pacman)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,sf,mapview)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"your_path/workshop_01"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">######################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="reading-spatial-data" class="level3">
<h3 class="anchored" data-anchor-id="reading-spatial-data">Reading spatial data</h3>
<p>Now we are ready to read in our spatial data. We will start with vector spatial data (see <a href="https://tmieno2.github.io/R-as-GIS-for-Economists-Quarto/chapters/02-VectorDataBasics.html" class="uri">https://tmieno2.github.io/R-as-GIS-for-Economists-Quarto/chapters/02-VectorDataBasics.html</a> for details on vector data). Read in the data using the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in Japan political boundaries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>jp_boundaries <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"inputs/gm-jpn-all_u_2_2/polbnda_jpn.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `polbnda_jpn' from data source 
  `/Users/judebayham/Documents/git_projects/ncu_workshop/docs/workshop_01/inputs/gm-jpn-all_u_2_2/polbnda_jpn.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 2914 features and 9 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 122.9335 ymin: 20.42274 xmax: 153.9869 ymax: 45.55733
Geodetic CRS:  ITRF94</code></pre>
</div>
</div>
<p>Note that the directory <code>gm-jpn-all_u_2_2</code> was created by default when unzipping the downloaded file. If successful, R prints out information in the console. First, the data format is ESRI Shapefile, which is one of many formats for storing spatial data. The <code>sf</code> package read the data in and created a simple feature collection with 2914 rows (features) and 9 columns (fields, variables or attributes). The features are polygons, which are enclosed multi-sided shapes defined by a series of points with lines connecting them. We can ignore the dimensions and bounding box for now. The Geodetic CRS is ITRF94 (<a href="https://epsg.io/4916" class="uri">https://epsg.io/4916</a>), which defines the coordinate reference system. This is information that tells <code>sf</code> how to interpret the location information (coordinates).</p>
<p>Let’s view the data on a map using the package <code>mapview</code>. The purpose of this map is to briefly inspect the data and make sure that it looks like what we expect - in this case, political boundaries of Japan.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a quick interactive map</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#mapview(jp_boundaries)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>